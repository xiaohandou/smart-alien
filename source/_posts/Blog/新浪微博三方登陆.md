---
title: "Django2.0.4与Vue联合实现新浪微博三方登陆"
tags: ["Django","Python","Vue"]
categories: ["编程 · 技术"]
date: "2020-06-02 13:02:18"
cover : /img/timg.jpg
---

### 序幕

[微博](https://baike.baidu.com/item/微博/79614)，又名微型博客，指的是一种基于用户关系信息分享、传播以及通过关注机制分享简短实时信息的广播式的[社交媒体](https://baike.baidu.com/item/社交媒体/1085698)、[网络平台](https://baike.baidu.com/item/网络平台/24446534)。与国外[Twitter](https://baike.baidu.com/item/twitter)、[Facebook](https://baike.baidu.com/item/Facebook?fromtitle=%E8%84%B8%E4%B9%A6&fromid=3462463)相似，在我国被广大年轻人喜爱。

### 新浪微博三方登陆

#### 创建应用

1. 首先`注册`、`登陆`[微博开放平台](https://open.weibo.com/)

2. 登陆之后，在`微连接`找到`网站接入`

   ![gitee](https://wangxs020202.gitee.io/images/note/sina1.png)

3. 进入，点击`立即接入`

   ![gitee](https://wangxs020202.gitee.io/images/note/sina2.png)

4. 设置自己的`应用名称`，将`应用分类`设置成`网页应用`，点击`创建`

   ![gitee](https://wangxs020202.gitee.io/images/note/sina3.png)

5. 下面这些我们不需要管，记住自己的APPID与APPKey，之后点击`高级设置`

   ![gitee](https://wangxs020202.gitee.io/images/note/sina4.png)

6. 设置`授权回调地址`和`取消授权回调地址`，可以自由更改

   ![gitee](https://wangxs020202.gitee.io/images/note/sina5.png)

7. 由于新浪微博规定如果不通过审核，那么新浪有些接口无权限请求的，可以说你手里只有access_token和uid，却换不到别的东西。所有我们要设置其他东西，点击`测试信息`,将个人的账号添加到测试里，就可以请求相应的接口。

   ![gitee](https://wangxs020202.gitee.io/images/note/sina6.png)

#### 代码接入

1. Vue

   ```vue
   函数名:(){
   		// 组装url
   		let url = "https://api.weibo.com/oauth2/authorize?client_id='APPID'&redirect_uri='回调地址'";
   		//跳转
   		window.location.href = url;
   
   	},
   ```

2. Django

   ```python
   def wb_back(request):
       # 获取code
       code = request.GET.get('code')
       # 定义微博认证地址
       access_token_url = "https://api.weibo.com/oauth2/access_token"
       # 参数
       res = requests.post(
           access_token_url,
           data={
               "client_id": 'APPID',
               "client_secret": "APPKey",
               "grant_type": "authorization_code",
               "code": code,
               "redirect_uri": "微博回调地址"
           }
       )
       # 转化类型
       res = json.loads(res.text)
       # 换取新浪微博昵称
       result = requests.get('https://api.weibo.com/2/users/show.json',
                             params={'access_token': res['access_token'], 'uid': res['uid']})
       result = json.loads(result.text)
       name = result['name']
   ```

   
