---
title: "Django2.0.4与Vue联合实现钉钉三方扫码登陆"
tags: ["Django","Python","Vue"]
categories: ["编程 · 技术"]
date: "2020-06-02 13:54:10"
cover : /img/timg.jpg
---

### 序幕

[钉钉](https://baike.baidu.com/item/钉钉)，学生党的噩梦，是[阿里巴巴集团](https://baike.baidu.com/item/阿里巴巴集团/9087864)专为[中国企业](https://baike.baidu.com/item/中国企业/12412310)打造的[免费](https://baike.baidu.com/item/免费/131326)沟通和协同的多端平台，帮助中国企业通过系统化的解决方案，全方位提升中国企业沟通和协同效率

### 创建应用

1. 首先注册[钉钉开发者平台](https://ding-doc.dingtalk.com/)，成功之后登陆

   

2. 登陆成功，进入`应用开发`

   

   ![gitee](https://wangxs020202.gitee.io/images/note/ding1.png)

   

3. 找到`移动接入应用`，进入`登陆`

   

   ![gitee](https://wangxs020202.gitee.io/images/note/ding2.png)

   

4. `创建扫码登录应用授权`

   

   ![gitee](https://wangxs020202.gitee.io/images/note/ding3.png)

   

5. `LOGO地址`就是你钉钉三方登陆的图片地址。`回调域名`可以自己设置

   

   ![gitee](https://wangxs020202.gitee.io/images/note/ding4.png)

   

6. 创建成功之后，会给你专属`APPID`,`APPKEY`

   

   ![gitee](https://wangxs020202.gitee.io/images/note/ding5.png)

### 代码接入

1. Vue

   ```vue
   函数名(){
           var appid = 'APPID'
       	var redirect_uri = '钉钉回调地址'
       	// 构成url
   		var url = 'https://oapi.dingtalk.com/connect/qrconnect?appid='+appid+'&response_type=code&scope=snsapi_login&state=STATE&redirect_uri='+redirect_uri
   		// 跳转
   		window.location.href = url;
         },
   ```

   

2. Django

   ```python
   #构造钉钉回调
   def ding_back(request):
       #获取code
       code = request.GET.get("code")
       t = time.time()
       #时间戳
       timestamp = str((int(round(t * 1000))))
       appSecret ='钉钉APPkey'
       #构造签名
       signature = base64.b64encode(hmac.new(appSecret.encode('utf-8'),timestamp.encode('utf-8'), digestmod=sha256).digest())
       #请求接口，换取钉钉用户名
       payload = {'tmp_auth_code':code}
       headers = {'Content-Type': 'application/json'}
       res = requests.post('https://oapi.dingtalk.com/sns/getuserinfo_bycode?signature='+urllib.parse.quote(signature.decode("utf-8"))+"&timestamp="+timestamp+"&accessKey=钉钉APPID",data=json.dumps(payload),headers=headers)
       #将JSON 字符串解码为 Python 对象   
       res_dict = json.loads(res.text)
       #获取用户名
       name = res_dict['user_info']['nick']
       return HttpResponse(name)
   ```

   

